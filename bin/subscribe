#!/usr/bin/env node
var instagram = require('../lib/instagram')();
var log = require('debug')('app');
var argv = require('minimist')(process.argv.slice(2));
var app = require('../waf.js')();
app.initAppSettings();
var unsubscribe = argv.unsubscribe || null;
var hashtag = argv.hashtag || null;
var callbackUlr = argv.callbackUlr || null;
var port = app.get('port');
var token = app.get('instagramSecurityToken');
var done = function(err){
    if(err){
        console.error(err.red);
        return;
    }
    log('Success');
};

if(!callbackUlr){
    var host = app.get('host');
    if(!host){
        host = 'http://localhost';
    }
    callbackUlr = host + ':' + port;
}
callbackUlr += '/instagram/subscribe';

if(!unsubscribe){
    action = 'subscribe';
    if(!hashtag){
        log('--hashtag params is not defined');
        return;
    }
}else{
    action = 'unsubscribe';
}

if(!token){
    token = argv.token || null;
}

switch(action){
    case 'subscribe':
        instagram.subscribeTag(hashtag, token, callbackUlr, done);
    break;
    case 'unsubscribe':
        instagram.unSubscribeTags(done);
    break;
}

return;